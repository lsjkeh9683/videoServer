# AI 사용법 숙지를 위한 프로젝트
# Video Server - Phase 1 MVP

개인용 미디어 서버 (Netflix 스타일 UI + 태그 시스템)

## 🎯 Phase 1 MVP 기능

### ✅ 구현된 핵심 기능
- **비디오 파일 스캔** - 디렉토리 스캔으로 자동 비디오 검색
- **썸네일 생성** - FFmpeg으로 자동 썸네일 생성  
- **정확한 태그 시스템** - 비디오에 태그 추가/제거/정확한 매칭 검색
- **All 태그 기능** - 모든 비디오 표시 vs 특정 태그 필터링
- **마우스 오버 미리보기** - 썸네일 호버 시 미리보기 재생
- **Netflix 스타일 UI** - 그리드 레이아웃 + 다크모드 + 세련된 태그 디자인
- **파일 업로드** - 드래그앤드롭 업로드 지원
- **비디오 스트리밍** - 범위 요청 지원 스트리밍

### 🛠 기술 스택
- **Backend**: Node.js + Express + SQLite
- **Frontend**: Vanilla JS + CSS Grid
- **Media**: FFmpeg (썸네일/미리보기 생성)
- **Database**: SQLite (경량화)

## 🚀 시작하기

### 1. 의존성 설치
```bash
npm install
```

### 2. 데이터베이스 초기화
```bash
npm run setup-db
```

### 3. FFmpeg 설치 확인
FFmpeg이 시스템에 설치되어 있어야 합니다:
- Windows: `choco install ffmpeg`
- macOS: `brew install ffmpeg` 
- Linux: `apt-get install ffmpeg`

### 4. 서버 시작
```bash
# 프로덕션 모드
npm start

# 개발 모드 (nodemon)
npm run dev
```

서버가 시작되면 http://localhost:3000 에서 접근 가능합니다.

## 📱 사용 방법

### 비디오 추가하기

**방법 1: 파일 업로드**
1. 웹 인터페이스에서 📤 Upload 버튼 클릭
2. 비디오 파일을 선택하거나 드래그앤드롭
3. 자동으로 썸네일 생성 및 DB 저장

**방법 2: 디렉토리 스캔**
1. 📁 Scan 버튼 클릭
2. 비디오 파일이 있는 디렉토리 경로 입력
3. 자동으로 모든 비디오 파일 스캔 및 처리

### 태그 관리
- 🏷️ **"All" 태그**: 모든 비디오 표시 (태그 설정 무관)
- 🎯 **특정 태그**: 해당 태그가 설정된 비디오만 필터링
- ✏️ **태그 편집**: 비디오 클릭 → 상세 모달에서 태그 추가/제거
- ➕ **태그 생성**: + New Tag로 새 태그 생성
- 🔍 **정확한 매칭**: 태그명이 정확히 일치하는 비디오만 검색

### 검색 기능
- 상단 검색박스에서 제목 또는 태그로 검색
- 실시간 검색 결과 표시

### 미리보기
- 비디오 썸네일에 마우스 호버 → 자동 미리보기 재생
- 클릭 시 전체 비디오 스트리밍 모달

## 📁 프로젝트 구조

```
videoServer/
├── src/
│   ├── server/           # Node.js 백엔드
│   │   ├── models/       # 데이터베이스 모델
│   │   ├── utils/        # 유틸리티 (스캔, 썸네일)
│   │   └── index.js      # 메인 서버
│   └── client/           # 프론트엔드
│       ├── index.html    # 메인 UI
│       ├── styles.css    # 스타일시트
│       └── app.js        # JavaScript
├── database/             # SQLite 데이터베이스
├── thumbnails/           # 생성된 썸네일
├── uploads/              # 업로드된 파일
└── docs/                 # 문서
```

## 🎯 Phase 1 MVP 테스트 포인트

### 1. 파일 스캔 테스트
- [ ] 대용량 디렉토리 스캔 (4TB 상당)
- [ ] 다양한 비디오 형식 지원 (MP4, MKV)
- [ ] 메타데이터 정확한 추출

### 2. 태그 시스템 테스트  
- [ ] 태그 생성/수정/삭제
- [ ] 비디오-태그 연결/해제
- [ ] 태그 기반 검색 정확도

### 3. 미리보기 테스트
- [ ] 썸네일 생성 성공률
- [ ] 마우스 호버 미리보기 동작
- [ ] 다양한 해상도 대응

### 4. 성능 테스트
- [ ] 라즈베리파이4 환경 테스트
- [ ] 대용량 파일 스트리밍
- [ ] 동시 접속 처리 (1-2명)

### 5. 버그 수정 테스트 ✅
- [x] 태그 필터링 정확도 검증
- [x] "All" 태그와 특정 태그 구분 동작
- [x] 빈 검색 결과 UI 상태 정리
- [x] 존재하지 않는 태그 선택 시 "No videos found" 표시

## 🐛 알려진 이슈 및 최근 수정사항

### 해결된 이슈 ✅
1. **태그 필터링 버그** (2024-01-07 수정)
   - 문제: 존재하지 않는 태그(예: "ANIMATION(0)")를 선택해도 비디오가 표시됨
   - 원인: 데이터베이스 쿼리에서 `LIKE '%tagName%'` 부분 매칭 사용
   - 해결: `WHERE t2.name = ?`로 정확한 매칭으로 변경
   - 영향: 태그 필터링이 이제 정확히 작동함

2. **UI 상태 불일치** (2024-01-07 수정)
   - 문제: 빈 검색 결과 시 이전 비디오가 화면에 남아있음
   - 원인: `showEmptyState()` 함수에서 `videoGrid` 내용을 지우지 않음
   - 해결: `renderVideos()`와 `showEmptyState()`에서 `videoGrid.innerHTML = ''` 추가
   - 영향: "No videos found" 상태에서 이전 비디오가 사라짐

3. **제목 중복 업데이트** (2024-01-07 수정)
   - 문제: `searchVideos()` 함수에서 제목을 업데이트하여 호출자의 제목이 덮어씌워짐
   - 해결: `searchVideos()` 함수에서 제목 업데이트 제거, 호출자가 직접 처리하도록 변경
   - 영향: 태그 필터링 시 올바른 제목 표시

### 현재 알려진 이슈
1. **FFmpeg 의존성**: FFmpeg이 설치되지 않으면 썸네일/미리보기 생성 실패
2. **파일 경로**: Windows/Linux 경로 차이 처리 필요
3. **대용량 파일**: 매우 큰 비디오 파일 처리 시 메모리 사용량 증가

## 🔄 다음 단계 (Phase 2)

1. **React 마이그레이션** - TypeScript + React 도입
2. **반응형 개선** - 모바일/태블릿 최적화  
3. **고급 검색** - 필터 조합, 정렬 옵션
4. **사용자 계정** - 로그인, 개인화 기능
5. **성능 최적화** - 캐싱, 지연 로딩

---

## 🆘 문제 해결

### 서버 시작 오류
```bash
# 포트 충돌 시
PORT=3001 npm start

# 권한 문제 시 (Linux/macOS)  
sudo npm start
```

### FFmpeg 오류
```bash
# FFmpeg 설치 확인
ffmpeg -version

# 경로 문제 시 환경변수 설정
export PATH=$PATH:/usr/local/bin
```

### 데이터베이스 초기화
```bash
# DB 파일 삭제 후 재생성
rm database/media.db
npm run setup-db
```

---

**🎬 Phase 1 MVP 완료!** 태그 시스템과 미리보기 기능이 핵심 목표대로 구현되었습니다.
